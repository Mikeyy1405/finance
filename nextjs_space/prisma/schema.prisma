generator client {
  provider      = "prisma-client-js"
  output        = "../node_modules/.prisma/client"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String        @id @default(cuid())
  email          String        @unique
  name           String?
  passwordHash   String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  transactions   Transaction[]
  categories     Category[]
  budgets        Budget[]
  bankUploads    BankUpload[]
  receipts       Receipt[]
  // Health module
  weightLogs     WeightLog[]
  waterLogs      WaterLog[]
  sleepLogs      SleepLog[]
  workouts       Workout[]
  medications    Medication[]
  // Family module
  familyEvents   FamilyEvent[]
  householdTasks HouseholdTask[]
  groceryItems   GroceryItem[]
  mealPlans      MealPlan[]
  // Goals module
  goals          Goal[]
  habits         Habit[]
  habitLogs      HabitLog[]
  journalEntries JournalEntry[]
  // Assets module
  vehicles       Vehicle[]
  subscriptions  Subscription[]
  // Collaborators: users I've given access to my data
  collaboratorsGiven    Collaborator[] @relation("Owner")
  // Collaborators: owners who gave me access to their data
  collaboratorsReceived Collaborator[] @relation("Collaborator")
  // Household membership
  householdMembers      HouseholdMember[]
}

model Collaborator {
  id             String   @id @default(cuid())
  ownerId        String
  owner          User     @relation("Owner", fields: [ownerId], references: [id], onDelete: Cascade)
  collaboratorId String
  collaborator   User     @relation("Collaborator", fields: [collaboratorId], references: [id], onDelete: Cascade)
  createdAt      DateTime @default(now())

  @@unique([ownerId, collaboratorId])
}

model Category {
  id           String        @id @default(cuid())
  name         String
  type         String
  icon         String?
  color        String?
  keywords     String?
  userId       String
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
  budgets      Budget[]
  createdAt    DateTime      @default(now())

  @@unique([name, userId])
}

model Transaction {
  id           String      @id @default(cuid())
  date         DateTime
  description  String
  amount       Float
  type         String
  categoryId   String?
  category     Category?   @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  userId       String
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  bankUploadId String?
  bankUpload   BankUpload? @relation(fields: [bankUploadId], references: [id], onDelete: SetNull)
  notes        String?
  receipt      Receipt?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Budget {
  id         String   @id @default(cuid())
  amount     Float
  month      Int
  year       Int
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([categoryId, month, year, userId])
}

model BankUpload {
  id           String        @id @default(cuid())
  filename     String
  uploadedAt   DateTime      @default(now())
  rowCount     Int
  userId       String
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions Transaction[]
}

model Receipt {
  id            String       @id @default(cuid())
  filename      String
  storeName     String?
  receiptDate   DateTime?
  totalAmount   Float?
  items         String?      // JSON array of line items
  rawText       String?      // AI-extracted text from receipt
  uploadedAt    DateTime     @default(now())
  userId        String
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactionId String?      @unique
  transaction   Transaction? @relation(fields: [transactionId], references: [id], onDelete: SetNull)
}

// ==========================================
// HEALTH MODULE
// ==========================================

model WeightLog {
  id        String   @id @default(cuid())
  date      DateTime
  weight    Float    // in kg
  note      String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model WaterLog {
  id        String   @id @default(cuid())
  date      DateTime
  glasses   Int      // number of glasses (250ml each)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([date, userId])
}

model SleepLog {
  id        String   @id @default(cuid())
  date      DateTime
  bedTime   DateTime
  wakeTime  DateTime
  quality   Int?     // 1-5 rating
  note      String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model Workout {
  id          String           @id @default(cuid())
  date        DateTime
  type        String           // cardio, strength, flexibility, etc.
  name        String
  duration    Int?             // minutes
  calories    Int?
  note        String?
  exercises   WorkoutExercise[]
  userId      String
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime         @default(now())
}

model WorkoutExercise {
  id        String  @id @default(cuid())
  name      String
  sets      Int?
  reps      Int?
  weight    Float?  // kg
  duration  Int?    // seconds
  workoutId String
  workout   Workout @relation(fields: [workoutId], references: [id], onDelete: Cascade)
}

model Medication {
  id        String   @id @default(cuid())
  name      String
  dosage    String?
  frequency String   // daily, weekly, as-needed
  time      String?  // e.g. "08:00"
  active    Boolean  @default(true)
  note      String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

// ==========================================
// HOUSEHOLD (GEZIN) MODULE
// ==========================================

model Household {
  id        String            @id @default(cuid())
  name      String
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  members   HouseholdMember[]
}

model HouseholdMember {
  id          String    @id @default(cuid())
  role        String    @default("member") // admin, member
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  householdId String
  household   Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())

  @@unique([userId, householdId])
}

// ==========================================
// FAMILY & HOUSEHOLD MODULE
// ==========================================

model FamilyEvent {
  id          String   @id @default(cuid())
  title       String
  date        DateTime
  endDate     DateTime?
  type        String   // birthday, appointment, school, holiday, other
  recurring   String?  // yearly, monthly, weekly, none
  description String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  householdId String?
  createdAt   DateTime @default(now())
}

model HouseholdTask {
  id          String    @id @default(cuid())
  title       String
  assignedTo  String?
  frequency   String    // daily, weekly, monthly, once
  dueDate     DateTime?
  completed   Boolean   @default(false)
  completedAt DateTime?
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  householdId String?
  createdAt   DateTime  @default(now())
}

model GroceryItem {
  id          String   @id @default(cuid())
  name        String
  quantity    String?
  category    String?  // groente, fruit, zuivel, etc.
  checked     Boolean  @default(false)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  householdId String?
  createdAt   DateTime @default(now())
}

model MealPlan {
  id          String   @id @default(cuid())
  date        DateTime
  mealType    String   // breakfast, lunch, dinner, snack
  name        String
  recipe      String?  // optional recipe text or link
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  householdId String?
  createdAt   DateTime @default(now())
}

// ==========================================
// GOALS & PRODUCTIVITY MODULE
// ==========================================

model Goal {
  id          String    @id @default(cuid())
  title       String
  description String?
  category    String    // finance, health, career, personal, family
  targetDate  DateTime?
  status      String    @default("active") // active, completed, paused
  progress    Int       @default(0) // 0-100
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Habit {
  id          String     @id @default(cuid())
  name        String
  icon        String?
  color       String?
  frequency   String     @default("daily") // daily, weekly
  targetCount Int        @default(1)
  active      Boolean    @default(true)
  logs        HabitLog[]
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime   @default(now())
}

model HabitLog {
  id        String   @id @default(cuid())
  date      DateTime
  count     Int      @default(1)
  habitId   String
  habit     Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([habitId, date, userId])
}

model JournalEntry {
  id        String   @id @default(cuid())
  date      DateTime
  title     String?
  content   String
  mood      Int?     // 1-5
  tags      String?  // comma-separated
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

// ==========================================
// ASSETS & SUBSCRIPTIONS MODULE
// ==========================================

model Vehicle {
  id              String           @id @default(cuid())
  name            String
  licensePlate    String?
  make            String?
  model           String?
  year            Int?
  mileage         Int?
  maintenanceLogs VehicleMaintenance[]
  userId          String
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt       DateTime         @default(now())
}

model VehicleMaintenance {
  id          String   @id @default(cuid())
  date        DateTime
  type        String   // apk, oil, tires, service, repair
  description String?
  cost        Float?
  mileage     Int?
  nextDue     DateTime?
  vehicleId   String
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
}

model Subscription {
  id          String   @id @default(cuid())
  name        String
  amount      Float
  frequency   String   // monthly, yearly, weekly
  category    String?  // streaming, software, gym, insurance, etc.
  startDate   DateTime
  nextPayment DateTime?
  active      Boolean  @default(true)
  note        String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
}
